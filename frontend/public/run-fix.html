<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Fix - Quiz Visibility</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .data { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Quick Fix - Quiz Visibility Issue</h1>
        <p>This will automatically fix the quiz visibility problem by setting up proper teacher/student data.</p>
        
        <button onclick="runQuickFix()">üîß Run Quick Fix</button>
        <button onclick="checkCurrentState()">üìä Check Current State</button>
        <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        
        <div id="result"></div>
    </div>

    <script>
        // Mock functions for testing
        function getCurrentUser() {
            try {
                const userData = localStorage.getItem('currentUser');
                return userData ? JSON.parse(userData) : null;
            } catch (e) {
                return null;
            }
        }

        function setCurrentUser(user) {
            try {
                localStorage.setItem('currentUser', JSON.stringify(user));
                return true;
            } catch (e) {
                return false;
            }
        }

        function getQuizzes() {
            try {
                const quizData = localStorage.getItem('quizzes');
                return quizData ? JSON.parse(quizData) : [];
            } catch (e) {
                return [];
            }
        }

        function saveQuizzes(quizzes) {
            try {
                localStorage.setItem('quizzes', JSON.stringify(quizzes));
                return true;
            } catch (e) {
                return false;
            }
        }

        function runQuickFix() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Step 1: Clear all data
                localStorage.clear();
                
                // Step 2: Set up teacher
                const teacher = {
                    id: 'teacher_001',
                    name: 'Test Teacher',
                    email: 'teacher@test.com',
                    role: 'teacher',
                    branch: 'CSE',
                    semester: 'Semester 1'
                };
                
                if (!setCurrentUser(teacher)) {
                    throw new Error('Failed to set teacher user');
                }
                
                // Step 3: Create quiz with matching data
                const quiz = {
                    id: 'quickfix_quiz_' + Date.now(),
                    name: 'Quick Fix Test Quiz - CSE Semester 1',
                    duration: 30,
                    branch: 'CSE',
                    semester: 'Semester 1',
                    subject: 'CSE',
                    numQuestions: 5,
                    setPaper: 'Set A',
                    createdAt: new Date().toISOString(),
                    createdBy: teacher.id,
                    questions: [
                        { question: "What is a computer?", options: ["Machine", "Animal", "Plant", "Mineral"], correctAnswer: 0 },
                        { question: "What does CPU stand for?", options: ["Central Process Unit", "Central Processing Unit", "Computer Personal Unit", "Central Processor Unit"], correctAnswer: 1 },
                        { question: "What is RAM?", options: ["Random Access Memory", "Read Access Memory", "Random Archive Memory", "Read Archive Memory"], correctAnswer: 0 },
                        { question: "What is an algorithm?", options: ["A recipe", "A song", "A dance", "A painting"], correctAnswer: 0 },
                        { question: "What is programming?", options: ["Writing code", "Building houses", "Cooking food", "Driving cars"], correctAnswer: 0 }
                    ]
                };
                
                if (!saveQuizzes([quiz])) {
                    throw new Error('Failed to save quiz');
                }
                
                // Step 4: Switch to student
                const student = {
                    id: 'student_001',
                    name: 'Test Student',
                    email: 'student@test.com',
                    role: 'student',
                    branch: 'CSE',
                    semester: 'Semester 1'
                };
                
                if (!setCurrentUser(student)) {
                    throw new Error('Failed to set student user');
                }
                
                // Step 5: Test visibility
                const quizzes = getQuizzes();
                const currentUser = getCurrentUser();
                
                const filteredQuizzes = quizzes.filter(quiz => {
                    const matchesStudentBranch = !currentUser.branch || quiz.branch === currentUser.branch;
                    const matchesStudentSemester = !currentUser.semester || quiz.semester === currentUser.semester;
                    return matchesStudentBranch && matchesStudentSemester;
                });
                
                const success = filteredQuizzes.length > 0;
                
                resultDiv.innerHTML = `
                    <div class="data">
                        <h3>üéâ Quick Fix Complete!</h3>
                        <p><strong>Status:</strong> <span class="${success ? 'success' : 'error'}">${success ? '‚úÖ SUCCESS' : '‚ùå FAILED'}</span></p>
                        <p><strong>Teacher:</strong> ${teacher.name} (${teacher.branch}, ${teacher.semester})</p>
                        <p><strong>Quiz:</strong> ${quiz.name}</p>
                        <p><strong>Student:</strong> ${student.name} (${student.branch}, ${student.semester})</p>
                        <p><strong>Visible Quizzes:</strong> ${filteredQuizzes.length}</p>
                        <p><strong>Branch Match:</strong> "${quiz.branch}" === "${currentUser.branch}"</p>
                        <p><strong>Semester Match:</strong> "${quiz.semester}" === "${currentUser.semester}"</p>
                    </div>
                    <div class="data">
                        <h4>Next Steps:</h4>
                        <p>1. Go to your main application: <a href="index.html" target="_blank">Open Main App</a></p>
                        <p>2. Log in as student (if not already)</p>
                        <p>3. Click "Load Available Quizzes"</p>
                        <p>4. The quiz should now be visible!</p>
                    </div>
                `;
                
                if (success) {
                    // Show detailed data
                    resultDiv.innerHTML += `
                        <div class="data">
                            <h4>Debug Data:</h4>
                            <p><strong>Current User:</strong></p>
                            <pre>${JSON.stringify(currentUser, null, 2)}</pre>
                            <p><strong>All Quizzes:</strong></p>
                            <pre>${JSON.stringify(quizzes, null, 2)}</pre>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function checkCurrentState() {
            const resultDiv = document.getElementById('result');
            const currentUser = getCurrentUser();
            const quizzes = getQuizzes();
            
            if (!currentUser) {
                resultDiv.innerHTML = '<div class="error">‚ùå No current user found</div>';
                return;
            }
            
            const studentBranch = currentUser?.branch || '';
            const studentSemester = currentUser?.semester || '';
            
            const filteredQuizzes = quizzes.filter(quiz => {
                const matchesStudentBranch = !studentBranch || quiz.branch === studentBranch;
                const matchesStudentSemester = !studentSemester || quiz.semester === studentSemester;
                return matchesStudentBranch && matchesStudentSemester;
            });
            
            resultDiv.innerHTML = `
                <div class="data">
                    <h3>Current System State:</h3>
                    <p><strong>Current User:</strong> ${currentUser.name} (${currentUser.role})</p>
                    <p><strong>Branch:</strong> "${studentBranch}"</p>
                    <p><strong>Semester:</strong> "${studentSemester}"</p>
                    <p><strong>Total Quizzes:</strong> ${quizzes.length}</p>
                    <p><strong>Visible Quizzes:</strong> ${filteredQuizzes.length}</p>
                    <p><strong>Status:</strong> <span class="${filteredQuizzes.length > 0 ? 'success' : 'error'}">
                        ${filteredQuizzes.length > 0 ? '‚úÖ Student can see quizzes' : '‚ùå Student cannot see any quizzes'}
                    </span></p>
                </div>
                <div class="data">
                    <h4>All Quizzes:</h4>
                    ${quizzes.map(quiz => {
                        const branchMatch = quiz.branch === studentBranch;
                        const semesterMatch = quiz.semester === studentSemester;
                        const isVisible = branchMatch && semesterMatch;
                        return `
                            <div class="data" style="margin: 10px 0; border-left: 4px solid ${isVisible ? '#28a745' : '#dc3545'}">
                                <p><strong>${quiz.name}</strong></p>
                                <p>Branch: "${quiz.branch}" vs "${studentBranch}" ${branchMatch ? '‚úÖ' : '‚ùå'}</p>
                                <p>Semester: "${quiz.semester}" vs "${studentSemester}" ${semesterMatch ? '‚úÖ' : '‚ùå'}</p>
                                <p>Visible: ${isVisible ? '‚úÖ YES' : '‚ùå NO'}</p>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function clearAllData() {
            localStorage.clear();
            document.getElementById('result').innerHTML = '<div class="success">‚úÖ All data cleared!</div>';
        }

        // Auto-run check on page load
        window.addEventListener('load', function() {
            setTimeout(checkCurrentState, 500);
        });
    </script>
</body>
</html>